<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>할일 수정</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="container">
    <h2>할일 수정</h2>

    <input id="title" placeholder="제목">
    <textarea id="description" placeholder="설명"></textarea>

    <button onclick="updateTodo()">수정</button>
    <button class="secondary" onclick="history.back()">취소</button>
  </div>

  <script>
    const id = new URLSearchParams(window.location.search).get("id");

    // 기존 값 불러오기 (undefined 방지)
    fetch(`/api/todos/${id}`, {
      headers: { "Accept": "application/json" }
    })
      .then(res => {
        if (!res.ok) throw new Error("failed to load");
        return res.json();
      })
      .then(todo => {
        document.getElementById("title").value = todo.title ?? "";
        document.getElementById("description").value = todo.description ?? "";
      })
      .catch(() => {
        alert("할일 정보를 불러오지 못했습니다.");
      });

    async function updateTodo() {
      const title = document.getElementById("title").value.trim();
      const description = document.getElementById("description").value.trim();

      const res = await fetch(`/api/todos/${id}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "Accept": "application/json"
        },
        body: JSON.stringify({ title, description })
      });

      if (!res.ok) {
        const text = await res.text();
        alert("수정 실패:\n" + text);
        return;
      }

      location.href = "index.html";
    }
  </script>
</body>
</html>
